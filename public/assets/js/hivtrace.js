webpackJsonp([0],{0:function(e,t,n){e.exports=n(1)},1:function(e,t,n){(function(e){"use strict";window.jQuery=window.$=e,n(5),n(15),n(17);var t=n(30);window.hivtrace=t}).call(t,n(2))},5:function(e,t){},15:function(e,t){},30:function(e,t,n){"use strict";var r,a=((r=n(31))&&r.__esModule,n(38)),i=n(47),o=n(46),s=n(43),l=n(44);e.exports.clusterNetwork=a.clusterNetwork,e.exports.graphSummary=a.graphSummary,e.exports.histogram=i.histogram,e.exports.histogramDistances=i.histogramDistances,e.exports.helpers=l,e.exports.misc=s,e.exports.scatterPlot=o.scatterPlot},31:function(e,t){},38:function(e,t,n){(function(t){"use strict";var r=n(39),a=n(42),i=n(43),o=n(44),s=n(46),l="patient_attribute_schema",c="patient_attributes",u="missing",d="#999",f=["circle","square","hexagon","diamond","cross","octagon","ellipse","pentagon"],p=r.format(",.2r"),h=r.format(",.3p"),g=r.time.format("%Y-%m-%dT%H:%M:%S.%LZ"),m=r.time.format("%B %d, %Y"),_=r.time.format("%B %Y"),v=["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],b=v.length,y=["#ffeda0","#feb24c","#f03b20"],x={trans_categ:{"MSM-Male":"#1f78b4","MSM-Unknown sex":"#1f78b4","Heterosexual Contact-Male":"#e31a1c","Heterosexual Contact-Female":"#e31a1c","Heterosexual Contact-Unknown sex":"#e31a1c","IDU-Male":"#33a02c","MSM & IDU-Male":"#33a02c","IDU-Female":"#33a02c","IDU-Unknown sex":"#33a02c","Other/Unknown-Male":"#636363","Other/Unknown-Female":"#636363","Other-Male":"#636363","Other-Female":"#636363",Missing:"#636363","":"#636363","Other/Unknown-Unknown sex":"#636363",Perinatal:"#ff7f00","Other/Unknown-Child":"#ff7f00","Other-Child":"#ff7f00"},race:{Asian:"#1f77b4","Black/African American":"#bcbd22","Hispanic/Latino":"#9467bd","American Indian/Alaska Native":"#2ca02c","Native Hawaiian/Other Pacific Islander":"#17becf","Multiple Races":"#e377c2","Unknown race":"#999",Missing:"#999",missing:"#999",White:"#d62728"}},w={birth_sex:{Male:"square",Female:"ellipse",Missing:"diamond",missing:"diamond",Unknown:"diamond"},race:{Asian:"hexagon","Black/African American":"square","Hispanic/Latino":"triangle","American Indian/Alaska Native":"pentagon","Native Hawaiian/Other Pacific Islander":"octagon","Multiple Races":"diamond","Unknown race":"diamond",Missing:"diamond",missing:"diamond",White:"ellipse"},current_gender:{Male:"square",Female:"ellipse","Transgender-Male to Female":"hexagon","Transgender-Female to Male":"pentagon","Additional Gender Identity":"diamond",Unknown:"diamond",Missing:"diamond",missing:"diamond"}};e.exports.clusterNetwork=function e(n,k,z,A,M,C,E,N,D,S,I){var R={};R._is_CDC_=!I||!I.no_cdc,R.ww=I&&I.width?I.width:r.select(S).property("clientWidth"),R.container=k,R.nodes=[],R.edges=[],R.clusters=[],R.cluster_sizes=[],R.cluster_mapping={},R.colorizer={selected:function(e){return"selected"==e?r.rgb(51,122,183):"#FFF"}},R.node_shaper={id:null,shaper:function(){return"circle"}},R.filter_edges=!0,R.hide_hxb2=!1,R.charge_correction=5,R.margin={top:20,right:10,bottom:30,left:10},R.width=R.ww-R.margin.left-R.margin.right,R.height=9*R.width/16,R.cluster_table=r.select(N),R.node_table=r.select(D),R.needs_an_update=!1,R.json=n,R.hide_unselected=!1,R.show_percent_in_pairwise_table=!1,R.gradient_id=0,R._additional_node_pop_fields=[],I&&"minimum size"in I?R.minimum_cluster_size=I["minimum size"]:R._is_CDC_?(R._additional_node_pop_fields.push("hiv_aids_dx_dt"),R.minimum_cluster_size=5):R.minimum_cluster_size=0,R.filter_by_size=function(e){return e.children.length>=R.minimum_cluster_size},R.current_size_filter=R.filter_by_size,R._networkPredefinedAttributeTransforms={binned_vl_recent_value:{depends:"vl_recent_value",label:"binned_vl_recent_value",enum:["≤200","200-10000",">10000"],color_scale:function(){return r.scale.ordinal().domain(["≤200","200-10000",">10000",u]).range(a.union(y,[d]))},map:function(e){var t=K(e,"vl_recent_value");return t!=u?t<=200?"≤200":t<=1e4?"200-10000":">10000":u}},age_dx:{depends:"age",label:"age_dx",enum:["<13","13-19","20-29","30-39","40-49","50-59","≥60"],color_scale:function(){return r.scale.ordinal().domain(["<13","13-19","20-29","30-39","40-49","50-59","≥60",u]).range(["#b10026","#e31a1c","#fc4e2a","#fd8d3c","#feb24c","#fed976","#ffffb2","#636363"])},map:function(e){var t=K(e,"age");return">=60"==t?"≥60":t}},hiv_aids_dx_dt_year:{depends:"hiv_aids_dx_dt",label:"hiv_aids_dx_dt_year",type:"String",map:function(e){try{var t=g.parse(K(e,"hiv_aids_dx_dt"));return t?""+t.getFullYear():u}catch(e){return u}},color_scale:function(e){var t=a.without(e.value_range,u),n=a.compose(r.interpolateRgb("#ffffcc","#800026"),r.scale.linear().domain([t[0],t[t.length-1]]).range([0,1]));return function(e){return e==u?d:n(e)}}}};var U=function e(t,n){var a=r.select(R.container),i="d3_context_menu_id",o=a.select("#"+i);o.empty()&&(o=a.append("ul").attr("id",i).attr("class","dropdown-menu").attr("role","menu")),o.selectAll("li").remove();var s=t&&1==t.fixed;t?(o.append("li").append("a").attr("tabindex","-1").text("Expand cluster").on("click",function(e){t.fixed=0,pe(t,!0),o.style("display","none")}),o.append("li").append("a").attr("tabindex","-1").text("Center on screen").on("click",function(e){t.fixed=0,function(e){e.x=R.width/2,e.y=R.height/2,R.update(!1,.4)}(t),o.style("display","none")}),o.append("li").append("a").attr("tabindex","-1").text(function(e){return t.fixed?"Allow cluster to float":"Hold cluster at current position"}).on("click",function(e){t.fixed=!t.fixed,o.style("display","none")}),t.fixed=1,o.style("position","absolute").style("left",r.event.offsetX+"px").style("top",r.event.offsetY+"px").style("display","block")):(n&&(n.fixed=0),o.style("display","none")),a.on("click",function(n){e(null,s?null:t)},!0)},T=function e(t){var n=r.select(R.container),a="d3_context_menu_id",i=n.select("#"+a);i.empty()&&(i=n.append("ul").attr("id",a).attr("class","dropdown-menu").attr("role","menu")),i.selectAll("li").remove(),t?(t.fixed=1,i.append("li").append("a").attr("tabindex","-1").text("Collapse cluster").on("click",function(e){t.fixed=0,function(e){se(R.clusters[R.cluster_mapping[e.cluster]]),R.update(!1,.4)}(t),i.style("display","none")}),i.style("position","absolute").style("left",r.event.offsetX+"px").style("top",r.event.offsetY+"px").style("display","block")):i.style("display","none"),n.on("click",function(t){e(null)},!0)};function j(e,t){var n,i;return e=(n=function(e){return a.groupBy(e,"cluster")}(R.nodes),i={id:"root",children:[]},R.exclude_cluster_ids&&(n=a.omit(n,R.exclude_cluster_ids)),i.children=a.map(n,function(e,t){return{cluster_id:t,children:e}}),r.layout.pack().size([R.width,R.height]).children(function(e){return e.children}).value(function(e){return 1}).nodes(i)).filter(function(e,t,n){return!(void 0===e.cluster_id)}),xe.size(),a.each(t,function(e){e.x+=e.dx/2,e.y+=e.dy/2}),e.forEach(se),[e,t]}function O(e){R.charge_correction=R.charge_correction*e,xe.start()}function F(e,t){if(e){var n=(R.width+e/2)/R.width,i=(R.height+e/2)/R.height;R.width+=e,R.height+=e;var o=r.scale.linear().domain(r.extent(xe.nodes(),function(e){return e.x}));o.range(a.map(o.domain(),function(e){return e*n}));var s=r.scale.linear().domain(r.extent(xe.nodes(),function(e){return e.y}));s.range(a.map(s.domain(),function(e){return e*i})),a.each(xe.nodes(),function(e){e.x=o(e.x),e.y=s(e.y)})}R.width=Math.min(Math.max(R.width,200),4e3),R.height=Math.min(Math.max(R.height,200),4e3),xe.size([R.width,R.height]),we.attr("width",R.width).attr("height",R.height),t?xe.start():e&&R.update(!0)}R.compute_adjacency_list=a.once(function(){R.nodes.forEach(function(e){e.neighbors=r.set()}),R.edges.forEach(function(e){R.nodes[e.source].neighbors.add(e.target),R.nodes[e.target].neighbors.add(e.source)})}),R.compute_local_clustering_coefficients=a.once(function(){R.compute_adjacency_list(),R.nodes.forEach(function(e){a.defer(function(e){if(neighborhood_size=e.neighbors.size(),neighborhood_size<2)e.lcc=i.undefined;else if(neighborhood_size>500)e.lcc=i.too_large;else{for(neighborhood=e.neighbors.values(),counter=0,n1=0;n1<neighborhood_size;n1+=1)for(n2=n1+1;n2<neighborhood_size;n2+=1)R.nodes[neighborhood[n1]].neighbors.has(neighborhood[n2])&&counter++;e.lcc=2*counter/neighborhood_size/(neighborhood_size-1)}},e)})}),R.get_node_by_id=function(e){return R.nodes.filter(function(t){return t.id==e})[0]},R.compute_local_clustering_coefficients_worker=a.once(function(){var e=new Worker("workers/lcc.js");e.onmessage=function(e){e.data.Nodes.forEach(function(e){node_to_update=R.get_node_by_id(e.id),node_to_update.lcc=e.lcc?e.lcc:i.undefined})};var t={};t.Nodes=R.nodes,t.Edges=R.edges,e.postMessage(t)});var B=a.memoize(function(e){return R.compute_adjacency_list(),a.reduce(a.first(a.pluck(e.children,"degree").sort(r.descending),3),function(e,t){return e*t},1)},function(e){return e.cluster_id});function L(e,n){if(!n){var a=t(e).data("sorted");return L(e,"asc"==a?"desc":"asc"),"asc"==a?r.descending:r.ascending}t(e).data("sorted",n),r.select(e).selectAll("i").classed("fa-sort-amount-desc","desc"==n).classed("fa-sort-amount-asc","asc"==n).classed("fa-sort","unsorted"==n)}function q(e,n,a){var i=r.select(a),o="function"==typeof e.value?e.value():e.value;if("callback"in e)e.callback(a,o);else{var s="format"in e?e.format(o):o;"html"in e?i.html(s):i.text(s),"sort"in e&&i.append("a").property("href","#").on("click",function(e){!function(e){r.event.preventDefault();var n=t(e).closest("table");if(n.length){var a=parseInt(t(e).data("column-id")),i=t(e).data("sort-on"),o=(t(e).data("sorted"),L(e)),s=i?function(e){var t=e[i];return"function"==typeof t?t():t}:function(e){return e};r.select(n[0]).select("tbody").selectAll("tr").sort(function(e,t){return o(s(e[a]),s(t[a]))}),t(n).find("thead [data-column-id]").filter(function(){return parseInt(t(this).data("column-id"))!=a}).each(function(){L(this,"unsorted")})}}(this)}).attr("data-sorted","unsorted").attr("data-column-id",n).attr("data-sort-on",e.sort).append("i").classed("fa fa-sort",!0).style("margin-left","0.2em")}"help"in e&&i.attr("title",e.help)}function P(e,t,n){var r=e.selectAll("thead");r.empty()&&(r=e.append("thead")).selectAll("tr").data(t).enter().append("tr").selectAll("th").data(function(e){return e}).enter().append("th").call(function(e){return e.each(function(e,t){q(e,t,this)})});var a=e.selectAll("tbody");a.empty()&&(a=e.append("tbody")).selectAll("tr").data(n).enter().append("tr").selectAll("td").data(function(e){return e}).enter().append("td").call(function(e){return e.each(function(e,t){q(e,t,this)})})}function Q(e,t){var n=r.select(e);n.selectAll("*").remove(),n.append("span").text(t).style("padding-right","0.5em"),n.append("button").classed("btn btn-primary btn-xs pull-right",!0).text("Zoom").attr("data-toggle","modal").attr("data-target","#"+M+"_cluster_zoom").attr("data-cluster",t),n.append("button").classed("btn btn-xs pull-right",!0).text("List").attr("data-toggle","modal").attr("data-target","#"+M+"_cluster_list").attr("data-cluster",t)}function G(e,t){var n=r.select(e),a=[[t[0]?"expand":"collapse",0]];t[1]&&a.push(["problematic",1]),t[2]&&a.push(["match",1]);var i=n.selectAll("button").data(a);i.enter().append("button"),i.exit().remove(),i.classed("btn btn-primary btn-xs",!0).text(function(e){return e[0]}).attr("disabled",function(e){return e[1]?"disabled":null}).on("click",function(n){0==n[1]&&(t[0]?le(R.clusters[t[t.length-1]-1],!0):se(R.clusters[t[t.length-1]-1]),q(r.select(e).datum(),null,e))})}function H(e,t){var n=r.select(e),a=[1==t.length?["can't be shown",1]:[t[0]?"hide":"show",0]],i=n.selectAll("button").data(a);i.enter().append("button"),i.exit().remove(),i.classed("btn btn-primary btn-xs btn-node-property",!0).text(function(e){return e[0]}).attr("disabled",function(e){return e[1]?"disabled":null}).on("click",function(n){0==n[1]&&(t[0]?se(R.clusters[t[t.length-1]-1],!0):le(R.clusters[t[t.length-1]-1]),q(r.select(e).datum(),null,e))})}function Y(e){if(e in w){var t=a.range(0,me[l][e].value_range.length);return{domain:t,range:a.map(t,function(t){return w[e][me[l][e].value_range[t]]})}}return{domain:a.range(0,me[l][e].dimension),range:f}}function W(e){var t="None";if(["#"+M+"_shapes"].forEach(function(n){r.select(n).selectAll("li").selectAll("a").attr("style",function(n,r){return n[1]==e?(t=n[0]," font-weight: bold;"):null}),r.select(n+"_label").html("Shape: "+t+' <span class="caret"></span>')}),e){var n=Y(e),a=r.scale.ordinal().domain(n.domain).range(n.range);R.node_shaper.id=e,R.node_shaper.shaper=function(t){return a(me[l][e].value_map(K(t,e)))},R.node_shaper.category_map=me[l][e].value_map}else R.node_shaper.id=null,R.node_shaper.shaper=function(){return"circle"},R.node_shaper.category_map=null;V(),R.update(!0),r.event.preventDefault()}function V(){ke.selectAll("g.hiv-trace-legend").remove();var e=10;if(R.colorizer.category_id)if(ke.append("g").attr("transform","translate(0,"+e+")").classed("hiv-trace-legend",!0).append("text").text("Color: "+R.colorizer.category_id).style("font-weight","bold"),e+=18,R.colorizer.continuous){var t="Date"==me[l][R.colorizer.category_id].type?_:r.format(",.4r"),n=me[l][R.colorizer.category_id].scale;a.each(a.range(9),function(r){var a=n.invert(r);ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(20,"+e+")").append("text").text(t(a)),ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(0,"+e+")").append("circle").attr("cx","8").attr("cy","-4").attr("r","8").classed("legend",!0).style("fill",R.colorizer.category(a)),e+=18}),ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(20,"+e+")").append("text").text("missing"),ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(0,"+e+")").append("circle").attr("cx","8").attr("cy","-4").attr("r","8").classed("legend",!0).style("fill",d),e+=18}else a.each(R.colorizer.category_map(null,"map"),function(t,n){ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(20,"+e+")").append("text").text(n),ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(0,"+e+")").append("circle").attr("cx","8").attr("cy","-4").attr("r","8").classed("legend",!0).style("fill",R.colorizer.category(n)),e+=18});if(R.node_shaper.id){ke.append("g").attr("transform","translate(0,"+e+")").classed("hiv-trace-legend",!0).append("text").text("Shape: "+R.node_shaper.id).style("font-weight","bold"),e+=18;var o=Y(R.node_shaper.id),s=r.scale.ordinal().domain(o.domain).range(o.range);a.each(R.node_shaper.category_map(null,"map"),function(t,n){ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(20,"+e+")").append("text").text(n),ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(0,"+e+")").append("path").attr("transform","translate(5,-5)").attr("d",i.symbol(s(t)).size(128)).classed("legend",!0).style("fill","none"),e+=18})}R.colorizer.opacity_id&&(ke.append("g").attr("transform","translate(0,"+e+")").classed("hiv-trace-legend",!0).append("text").text("Opacity: "+R.colorizer.opacity_id).style("font-weight","bold"),e+=18,t="Date"==me[l][R.colorizer.opacity_id].type?_:r.format(",.4r"),n=me[l][R.colorizer.opacity_id].scale,a.each(a.range(9),function(r){var a=n.invert(r);ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(20,"+e+")").append("text").text(t(a)),ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(0,"+e+")").append("circle").attr("cx","8").attr("cy","-4").attr("r","8").classed("legend",!0).style("fill","black").style("opacity",R.colorizer.opacity(a)),e+=18}),ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(20,"+e+")").append("text").text("missing"),ke.append("g").classed("hiv-trace-legend",!0).attr("transform","translate(0,"+e+")").append("circle").attr("cx","8").attr("cy","-4").attr("r","8").classed("legend",!0).style("fill","black").style("opacity","0.1"),e+=18)}function Z(e,t){if(t){var n="hivtrace-cluster-gradient-"+R.gradient_id++,r=we.selectAll("defs").append("radialGradient").attr("id",n),i=a.map(e.children,function(e){var n=K(e,t);return n==u?1/0:n}).sort(function(e,t){return 0+e-(0+t)}),o=a.filter(i,function(e){return e<1/0}),s=i.length-o.length;return s&&(r.append("stop").attr("offset","0%").attr("stop-color",d),r.append("stop").attr("offset",s/i.length*100+"%").attr("stop-color",d)),a.each(o,function(e,t){r.append("stop").attr("offset",100*(1+t+s)/i.length+"%").attr("stop-color",R.colorizer.category(e))}),n}return null}function X(e){var t="None";if(["#"+M+"_opacity"].forEach(function(n){r.select(n).selectAll("li").selectAll("a").attr("style",function(n,r){return n[1]==e?(t=n[0]," font-weight: bold;"):null}),r.select(n+"_label").html("Opacity: "+t+' <span class="caret"></span>')}),r.select("#"+M+"_opacity_invert").style("display","None"==t?"none":"inline").classed("btn-active",!1).classed("btn-default",!0),R.colorizer.opacity_id=e,e){var n=me[l][e].scale;R.colorizer.opacity_scale=r.scale.linear().domain([0,8]).range([.25,1]),R.colorizer.opacity=function(e){return e==u?"0.1":R.colorizer.opacity_scale(n(e))}}else R.colorizer.opacity=null,R.colorizer.opacity_scale=null;V(),R.update(!0),r.event.preventDefault()}function J(e){var t="None";if(ue("#"+M+"_aux_svg_holder",null,null),ce("#"+M+"_attribute_table",null,null),we.selectAll("radialGradient").remove(),R.clusters.forEach(function(e){delete e.binned_attributes,delete e.gradient}),["#"+M+"_attributes","#"+M+"_attributes_cat"].forEach(function(n){r.select(n).selectAll("li").selectAll("a").attr("style",function(n,r){return n[1]==e?(t=n[0]," font-weight: bold;"):null}),r.select(n+"_label").html("Color: "+t+' <span class="caret"></span>')}),r.select("#"+M+"_attributes_invert").style("display","None"==t?"none":"inline").classed("btn-active",!1).classed("btn-default",!0),e){R.colorizer.category=a.wrap(r.scale.linear().range(["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]).domain(a.range(9)),function(t,n){return t(me[l][e].scale(n))}),R.colorizer.category_id=e,R.colorizer.continuous=!0,R.clusters.forEach(function(t){t.gradient=Z(t,e)});var n=[];a.each(R.edges,function(t){var r=K(R.nodes[t.source],e),a=K(R.nodes[t.target],e);r!=u&&a!=u&&n.push({x:r,y:a,title:R.nodes[t.source].id+" ("+r+") -- "+R.nodes[t.target].id+" ("+a+")"})}),r.select("#"+M+"_aux_svg_holder_enclosed").style("display",null),s.scatterPlot(n,400,400,"#"+M+"_aux_svg_holder",{x:"Source",y:"Target"},"Date"==me[l][e].type)}else R.colorizer.category=null,R.colorizer.category_id=null,R.colorizer.continuous=!1,R.colorizer.category_pairwise=null,R.colorizer.category_map=null;V(),R.update(!0),r.event.preventDefault()}function $(e){var t="None";if(r.select("#"+M+"_attributes_invert").style("display","none"),we.selectAll("radialGradient").remove(),["#"+M+"_attributes","#"+M+"_attributes_cat"].forEach(function(n){r.select(n).selectAll("li").selectAll("a").attr("style",function(n,r){return n[1]==e?(t=n[0]," font-weight: bold;"):null}),r.select(n+"_label").html("Color: "+t+' <span class="caret"></span>')}),R.clusters.forEach(function(t){delete t.gradient,t.binned_attributes=function(e){if(e){var t={},n=[];for(var r in e.forEach(function(e){e in t?t[e]+=1:t[e]=1}),t)n.push([r,t[r]]);return n.sort(function(e,t){return e[0]-t[0]})}return e}(function(e,t){return t&&e?e.children.map(function(e){return K(e,t)}):null}(t,e))}),R.colorizer.continuous=!1,e){if(e in x){var n=[],i=[];a.each(x[e],function(e,t){n.push(t),i.push(e)}),R.colorizer.category=r.scale.ordinal().domain(n).range(i)}else if(me[l][e].color_scale)R.colorizer.category=me[l][e].color_scale(me[l][e]);else{R.colorizer.category=r.scale.ordinal().range(v);var o=a.clone(R.colorizer.category.range());o.push(d),R.colorizer.category.domain(a.range(b+1)),R.colorizer.category.range(o),me[l][e]["stable-ish order"]&&(R.colorizer.category=a.wrap(R.colorizer.category,function(t,n){return t(n==u?b:me[l][e]["stable-ish order"][n])}))}R.colorizer.category_id=e,R.colorizer.category_map=me[l][e].value_map,R.colorizer.category_pairwise=function(e,t,n){for(var r=R.edges,i=[],o=0;o<t;o+=1){i.push([]);for(var s=0;s<t;s+=1)i[o].push(0)}if(a.each(r,function(t){i[n(K(R.nodes[t.source],e))][n(K(R.nodes[t.target],e))]+=1}),!i.some(function(e,n){return n==t-1?e.some(function(e){return e>0}):e[t-1]>0}))for(i.pop(),o=0;o<t-1;o+=1)i[o].pop();for(t=i.length,o=0;o<t;o+=1)for(s=o;s<t;s+=1)i[o][s]+=i[s][o],i[s][o]=i[o][s];return i}(e,me[l][e].dimension,R.colorizer.category_map),ue("#"+M+"_aux_svg_holder",R.colorizer.category_map,R.colorizer.category_pairwise),ce("#"+M+"_attribute_table",R.colorizer.category_map,R.colorizer.category_pairwise)}else R.colorizer.category=null,R.colorizer.category_id=null,R.colorizer.category_pairwise=null,R.colorizer.category_map=null,ue("#"+M+"_aux_svg_holder",null,null),ce("#"+M+"_attribute_table",null,null);V(),R.update(!0),r.event.preventDefault()}function K(e,t,n){if(c in e&&t&&t in e[c]){var r=e[c][t];if(a.isString(r)){if(0==r.length)return u;if(n)return+r}return r}return u}function ee(e,t,n){c in e&&t&&(e[c][t]=n)}function te(e){var t=5+Math.sqrt(e.degree);return 4*t*t}function ne(e){return R.colorizer.opacity?R.colorizer.opacity(K(e,R.colorizer.opacity_id)):1}function re(e){var t,n;he(this,!0,(R._is_CDC_?"Individual ":"Node ")+e.id,(t=e,n=R._is_CDC_?"# links <em>"+t.degree+"</em>":"Degree <em>"+t.degree+"</em><br>Clustering coefficient <em> "+i.format_value(t.lcc,p)+"</em>",a.each(a.union(R._additional_node_pop_fields,[R.colorizer.category_id,R.node_shaper.id,R.colorizer.opacity_id]),function(e){if(e&&e in me[l]){var r=K(t,e);if("Date"==me[l][e].type)try{r=m(r)}catch(e){}r&&(n+="<br>"+e+" <em>"+r+"</em>")}}),n),R.container)}function ae(e){he(this,!1)}function ie(e){var t,n;he(this,!0,e.source.id+" - "+e.target.id,(n="Length <em>"+p((t=e).length)+"</em>","support"in t&&(n+="<br>Worst triangle-based support (p): <em>"+p(t.support)+"</em>"),K(t,R.colorizer.category_id),n),R.container)}function oe(e){he(this,!1)}function se(e,t){if(R.needs_an_update=!0,e.collapsed=!0,ge-=R.cluster_sizes[e.cluster_id-1]-1,!t){var n=be.indexOf(e.cluster_id);n>=0&&be.splice(n,1)}return function(e){for(var t in e){var n=e[t];n.x=0,n.y=0,a.has(n,"children")&&(n.children.forEach(function(e){n.x+=e.x,n.y+=e.y}),n.x/=n.children.length,n.y/=n.children.length)}}([e]),e.children.length}function le(e,t){R.needs_an_update=!0,e.collapsed=!1,ge+=R.cluster_sizes[e.cluster_id-1]-1,be.push(e.cluster_id),t?e.children.forEach(function(t){t.x=e.x+(Math.random()-.5)*e.children.length,t.y=e.y+(Math.random()-.5)*e.children.length}):e.children.forEach(function(t){t.x=.25*R.width+(Math.random()-.5)*e.children.length,t.y=.25*R.height+(Math.random()-.5)*e.children.length})}function ce(e,t,n){var i=r.select(e);if(i.selectAll("thead").remove(),i.selectAll("tbody").remove(),r.select(e+"_enclosed").style("display",n?null:"none"),n){var o=R.colorizer.category,s=t(null,"lookup"),l=i.append("thead").append("tr").selectAll("th").data([""].concat(n[0].map(function(e,t){return s[t]})));if(l.enter().append("th"),l.html(function(e){return"<span>&nbsp;"+e+"</span>"}).each(function(e,t){t&&r.select(this).insert("i",":first-child").classed("fa fa-circle",!0).style("color",function(){return o(e)})}),R.show_percent_in_pairwise_table){var c=a.map(n,function(e){return a.reduce(e,function(e,t){return e+t},0)});n=a.map(n,function(e,t){return a.map(e,function(e){return e/c[t]})})}var u=i.append("tbody").selectAll("tr").data(n.map(function(e,t){return[s[t]].concat(e)}));u.enter().append("tr"),u.selectAll("td").data(function(e){return e}).enter().append("td").html(function(e,t){return 0==t?"<span>&nbsp;"+e+"</span>":R.show_percent_in_pairwise_table?h(e):e}).each(function(e,t){0==t&&r.select(this).insert("i",":first-child").classed("fa fa-circle",!0).style("color",function(){return o(e)})})}}function ue(e,t,n){if(r.select(e).selectAll("svg").remove(),r.select(e+"_enclosed").style("display",n?null:"none"),n){var a=function(e,t){return function(n,r){d.text(t?i[r]:""),o.selectAll(".chord path").filter(function(e){return e.source.index!=r&&e.target.index!=r}).transition().style("opacity",e)}},i=t(null,"lookup"),o=r.select(e).append("svg"),s=r.layout.chord().padding(.05).sortSubgroups(r.descending).matrix(n),l=.41*Math.min(450,430),c=1.1*l,u=R.colorizer.category,d=o.append("g").attr("transform","translate(225,430)").append("text").attr("text-anchor","middle").attr("font-size",12).text("");(o=o.attr("width",450).attr("height",430).append("g").attr("transform","translate(225,215)")).append("g").selectAll("path").data(s.groups).enter().append("path").style("fill",function(e){return u(i[e.index])}).style("stroke",function(e){return u(i[e.index])}).attr("d",r.svg.arc().innerRadius(l).outerRadius(c)).on("mouseover",a(.1,!0)).on("mouseout",a(1,!1)),o.append("g").attr("class","chord").selectAll("path").data(s.chords).enter().append("path").attr("d",r.svg.chord().radius(l)).style("fill",function(e){return u(e.target.index)}).style("opacity",1)}}function de(e){var t,n,r,a;he(this,!0,"Cluster "+e.cluster_id,(t=e.cluster_id,a=(r=R.clusters[R.cluster_mapping[t]]).binned_attributes,n=R._is_CDC_?"<strong>"+R.cluster_sizes[t-1]+"</strong> individuals.<br>Mean links/individual <em> = "+p(r.degrees.mean)+"</em><br>Max links/individual <em> = "+r.degrees.max+"</em>":"<strong>"+R.cluster_sizes[t-1]+"</strong> nodes.<br>Mean degree <em>"+p(r.degrees.mean)+"</em><br>Max degree <em>"+r.degrees.max+"</em><br>Clustering coefficient <em> "+i.format_value(r.cc,p)+"</em>",a&&a.forEach(function(e){n+="<br>"+e[0]+" <em>"+e[1]+"</em>"}),n),R.container)}function fe(e){he(this,!1)}function pe(e,t,n){if(e.collapsed){var r=R.cluster_sizes[e.cluster_id-1]-1;if(r>_e)ve="This cluster is too large to be displayed";else{var a=r+ge-_e;if(a>0){for(var i=0;i<be.length&&a>0;i++){var o=R.clusters[R.cluster_mapping[be[i]]];a-=o.children.length-1,se(o,!0)}(i||be.length)&&be.splice(0,i)}a<=0&&le(e,!n)}t&&R.update(!1,.6)}return""}function he(e,n,i,o,s){if(n&&!e.tooltip){t("[role='tooltip']").each(function(e){t(this).remove()});var l=t(e);r.select(e).datum(),e.tooltip=l.tooltip({title:i+"<br>"+o,html:!0,container:s||"body"}),a.delay(a.bind(e.tooltip.tooltip,e.tooltip),500,"show")}else 0==n&&e.tooltip&&(e.tooltip.tooltip("destroy"),e.tooltip=void 0)}R.compute_global_clustering_coefficients=a.once(function(){R.compute_adjacency_list(),R.clusters.forEach(function(e){a.defer(function(e){if(cluster_size=e.children.length,cluster_size<3)e.cc=i.undefined;else if(B(e,!0)>=5e6)e.cc=i.too_large;else{member_nodes=[];var t=0,n=0;R.nodes.forEach(function(t,n){t.cluster==e.cluster_id&&member_nodes.push(n)}),member_nodes.forEach(function(e){for(my_neighbors=R.nodes[e].neighbors.values().map(function(e){return+e}).sort(r.ascending),n1=0;n1<my_neighbors.length;n1+=1)for(n2=n1+1;n2<my_neighbors.length;n2+=1)t+=1,R.nodes[my_neighbors[n1]].neighbors.has(my_neighbors[n2])&&(n+=1)}),e.cc=n/t}},e)})}),R.mark_nodes_as_processing=function(e){R.nodes.forEach(function(t){t[e]=i.processing})},R.compute_graph_stats=function(){r.select(this).classed("disabled",!0).select("i").classed({"fa-calculator":!1,"fa-cog":!0,"fa-spin":!0}),R.mark_nodes_as_processing("lcc"),R.compute_local_clustering_coefficients_worker(),R.compute_global_clustering_coefficients(),r.select(this).remove()},R.update_volatile_elements=function(e){e.selectAll("td").filter(function(e,t){return"volatile"in e}).each(function(e,t){q(e,t,this)})},R.filter_visibility=function(){R.clusters.forEach(function(e){e.is_hidden=R.hide_unselected&&!e.match_filter}),R.nodes.forEach(function(e){e.is_hidden=R.hide_unselected&&!e.match_filter})},R.filter=function(e,t){var n=!1;(e=a.map(["re","distance"],function(t){return a.map(a.filter(e,function(e){return e.type==t}),function(e){return e.value})}))[1].length?(R.nodes.forEach(function(e){e.length_filter=!1}),a.each(R.edges,function(t){a.some(e[1],function(e){return t.length<=e})&&(R.nodes[t.source].length_filter=!0,R.nodes[t.target].length_filter=!0)})):R.nodes.forEach(function(e){e.length_filter=!1}),R.clusters.forEach(function(e){e.match_filter=0}),R.nodes.forEach(function(t){var r=a.some(e[0],function(e){return e.test(t.id)||a.some(t[c],function(t){return e.test(t)})});(r=r||t.length_filter)!=t.match_filter&&(t.match_filter=r,n=!0),t.match_filter&&(t.parent.match_filter+=1)}),n&&!t&&(R.hide_unselected&&R.filter_visibility(),R.update(!0))},R.is_empty=function(){return 0==R.cluster_sizes.length},R.update=function(e,t){var n,o,s,l,c,f;if(R.needs_an_update=!1,t&&xe.friction(t),A&&(ve.length?(r.select(A).text(ve).style("display","block"),ve=""):r.select(A).style("display","none")),e)n=we.selectAll(".node"),o=we.selectAll(".cluster-group"),s=we.selectAll(".link");else{var h=(l={all:[],edges:[],nodes:[],clusters:[]},c=[],f=[],R.clusters.forEach(function(e){R.current_size_filter(e)&&(e.children.some(function(e){return e.hxb2_linked})&&R.hide_hxb2||(e.collapsed?(l.clusters.push(e),l.all.push(e)):c[e.cluster_id]=!0))}),R.nodes.forEach(function(e,t){c[e.cluster]&&(f[t]=l.nodes.length+l.clusters.length,l.nodes.push(e),l.all.push(e))}),R.edges.forEach(function(e){if(!(e.removed&&R.filter_edges||void 0===f[e.source]||void 0===f[e.target])){var t={};for(var n in e)t[n]=e[n];t.source=f[e.source],t.target=f[e.target],l.edges.push(t)}}),l);xe.nodes(h.all).links(h.edges).start(),function(e){if(z){var t=a.filter(R.clusters,function(e){return!e.collapsed}).length,n=(R.cluster_sizes.length,R.clusters.length,me.Nodes.length,R.nodes.length,"<span class = 'badge'>"+R.clusters.length+"</span> clusters <span class = 'label label-primary'>"+t+" expanded</span> <span class = 'badge'> "+R.nodes.length+"</span> nodes <span class = 'label label-primary'>"+e.nodes.length+" shown</span> <span class = 'badge'>"+R.edges.length+"</span> "+(R._is_CDC_?"links":"edges")+" <span class = 'label label-primary'>"+e.edges.length+" shown</span>");r.select(z).html(n)}}(h),(s=we.selectAll(".link").data(h.edges,function(e){return e.id})).enter().append("line").classed("link",!0),s.exit().remove(),s.classed("removed",function(e){return e.removed}).classed("unsupported",function(e){return"support"in e&&e.support>.05}).on("mouseover",ie).on("mouseout",oe).filter(function(e){return e.directed}).attr("marker-end","url(#arrowhead)"),(n=we.selectAll(".node").data(h.nodes,function(e){return e.id})).exit().remove(),n.enter().append("path"),(o=we.selectAll(".cluster-group").data(h.clusters.map(function(e){return e}),function(e){return e.cluster_id})).exit().remove(),o.enter().append("g").attr("class","cluster-group").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).on("click",U).on("mouseover",de).on("mouseout",fe).call(xe.drag().on("dragstart",fe)),R.cluster_table&&P(R.cluster_table,[[{value:"Cluster ID",sort:"value",help:"Unique cluster ID"},{value:"Visibility",sort:"value",help:"Visibility in the network tab"},{value:"Size",sort:"value",help:"Number of nodes in the cluster"},{value:"# links/node<br>Mean [Median, IQR]",html:!0},{value:"Genetic distance<br>Mean [Median, IQR]",help:"Genetic distance among nodes in the cluster",html:!0}]],R.clusters.map(function(e,t){return[{value:e.cluster_id,callback:Q},{value:function(){return[e.collapsed,e.hxb2_linked,e.match_filter,e.cluster_id]},callback:G,volatile:!0},{value:e.children.length},{value:e.degrees,format:function(e){return p(e.mean)+" ["+p(e.median)+", "+p(e.Q1)+" - "+p(e.Q3)+"]"}},{value:e.distances,format:function(e){return p(e.mean)+" ["+p(e.median)+", "+p(e.Q1)+" - "+p(e.Q3)+"]"}}]})),R.node_table&&P(R.node_table,[[{value:"ID",sort:"value",help:"Node ID"},{value:"Status",sort:"value"},{value:"# of links",sort:"value",help:"Number of links (Node degree)"},{value:"Cluster",sort:"value",help:"Which cluster does the node belong to"}]],R.nodes.map(function(e,t){return[{value:e.id,help:"Node ID"},{value:function(){try{return R.exclude_cluster_ids[e.cluster]?[e.cluster]:[!R.clusters[R.cluster_mapping[e.cluster]].collapsed,e.cluster]}catch(e){}},callback:H,volatile:!0},{value:e.degree,help:"Node degree"},{value:e.cluster,help:"Which cluster does the node belong to"}]}))}n.each(function(e){!function(e,t){e=r.select(e);var n=t.hxb2_linked&&!t.is_lanl?"cross":t.is_lanl?"triangle-down":R.node_shaper.shaper(t);t.rendered_size=Math.sqrt(te(t))/2+2,e.attr("d",i.symbol(n).size(te(t))).attr("class","node").classed("selected_object",function(e){return e.match_filter}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).style("fill",function(e){return function(e){if(R.colorizer.category_id){var t=K(e,R.colorizer.category_id);return R.colorizer.continuous&&t==u?d:R.colorizer.category(t)}return e.hxb2_linked?"black":e.is_lanl?"red":"gray"}(e)}).style("opacity",function(e){return ne(e)}).style("display",function(e){return e.is_hidden?"none":null}).on("click",T).on("mouseover",re).on("mouseout",ae).call(xe.drag().on("dragstart",ae))}(this,e)}),o.each(function(e){!function(e,t){var n=r.select(e),a=t.binned_attributes?t.binned_attributes.map(function(e){return e.concat([0])}):[[null,1,0]];t.match_filter&&(a=a.concat([["selected",t.match_filter,1],["not selected",t.children.length-t.match_filter,1]]));var i=[r.sum(a.filter(function(e){return 0==e[2]}),function(e){return e[1]}),r.sum(a.filter(function(e){return 0!=e[2]}),function(e){return e[1]})],o=[0,0];a=a.map(function(n){var r=n[2],a={container:e,cluster:t,startAngle:o[r]/i[r]*2*Math.PI,endAngle:(o[r]+n[1])/i[r]*2*Math.PI,name:n[0],rim:r>0};return o[r]+=n[1],a});var s,l=.5*(s=t,8*Math.sqrt(s.children.length));t.rendered_size=l+2;var c=n.selectAll("path").data(a);c.enter().append("path"),c.exit().remove(),c.classed("cluster",!0).classed("hiv-trace-problematic",function(e){return t.hxb2_linked&&!e.rim}).classed("hiv-trace-selected",function(e){return e.rim}).attr("d",function(e){return(e.rim?r.svg.arc().innerRadius(l+2).outerRadius(l+5):r.svg.arc().innerRadius(0).outerRadius(l))(e)}).style("fill",function(e,n){return e.rim?R.colorizer.selected(e.name):t.gradient?"url(#"+t.gradient+")":function(e,t){return e.binned_attributes?R.colorizer.category(t):"#bdbdbd"}(t,e.name)}).style("stroke-linejoin",function(e,t){return a.length>1?"round":""}).style("display",function(e){return t.is_hidden?"none":null})}(this,e)}),s.style("opacity",function(e){return Math.max(ne(e.target),ne(e.source))}),s.style("display",function(e){return e.target.is_hidden||e.source.is_hidden?"none":null}),e?s.each(function(e){r.select(this).attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})}):(ge=o[0].length+n[0].length,xe.on("tick",function(){var e=xe.size();n.attr("transform",function(t){return"translate("+(t.x=Math.max(t.rendered_size,Math.min(e[0]-t.rendered_size,t.x)))+","+(t.y=Math.max(t.rendered_size,Math.min(e[1]-t.rendered_size,t.y)))+")"}),o.attr("transform",function(t){return"translate("+(t.x=Math.max(t.rendered_size,Math.min(e[0]-t.rendered_size,t.x)))+","+(t.y=Math.max(t.rendered_size,Math.min(e[1]-t.rendered_size,t.y)))+")"}),s.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})}))},R.expand_some_clusters=function(e){(e=e||R.clusters).forEach(function(e){e.is_hidden||pe(e,!1)}),R.update()},R.select_some_clusters=function(e){return R.clusters.filter(function(t,n){return a.some(t.children,function(t){return e(t)})})},R.collapse_some_clusters=function(e){(e=e||R.clusters).forEach(function(e){e.collapsed||se(e)}),R.update()},R.toggle_hxb2=function(){R.hide_hxb2=!R.hide_hxb2,R.update()},t("#reset_layout").click(function(e){j(clusters,nodes),R.update(),e.preventDefault()});var ge,me=R.json,_e=1024,ve="",be=[],ye=r.scale.pow().exponent(.5).domain([1,1e5]).range([.1,.15]),xe=r.layout.force().on("tick",function(){var e=xe.size();node.attr("cx",function(t){return t.x=Math.max(10,Math.min(e[0]-10,t.x))}).attr("cy",function(t){return t.y=Math.max(10,Math.min(e[1]-10,t.y))}),link.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})}).charge(function(e){return e.cluster_id?R.charge_correction*(-20-5*Math.pow(e.children.length,.7)):R.charge_correction*(-5-20*Math.sqrt(e.degree))}).linkDistance(function(e){return 5e3*Math.max(e.length,.005)}).linkStrength(function(e){return void 0!==e.support?2*(.5-e.support):1}).chargeDistance(1250).gravity(ye(n.Nodes.length)).friction(.25);r.select(R.container).selectAll(".my_progress").style("display","none"),r.select(R.container).selectAll("svg").remove(),R.node_table.selectAll("*").remove(),R.cluster_table.selectAll("*").remove();var we=r.select(R.container).append("svg:svg").attr("id","network-svg").attr("width",R.width+R.margin.left+R.margin.right).attr("height",R.height+R.margin.top+R.margin.bottom),ke=we.append("g").attr("transform","translate(5,5)");return we.append("defs").append("marker").attr("id","arrowhead").attr("refX",9).attr("refY",2).attr("markerWidth",6).attr("markerHeight",4).attr("orient","auto").attr("stroke","#666666").attr("fill","#AAAAAA").append("path").attr("d","M 0,0 V 4 L6,2 Z"),F(),function(){var i=[],s=0;if(R.exclude_cluster_ids={},R.has_hxb2_links=!1,R.cluster_sizes=[],me.Nodes.forEach(function(e){void 0===R.cluster_sizes[e.cluster-1]?R.cluster_sizes[e.cluster-1]=1:R.cluster_sizes[e.cluster-1]++,"is_lanl"in e&&(e.is_lanl="true"==e.is_lanl),e.attributes.indexOf("problematic")>=0&&(R.has_hxb2_links=e.hxb2_linked=!0)}),M){var c=function(e,t,n){n.selectAll("*").remove();var r={String:1,Date:1,Number:1},i=a.filter(R.json[l],function(e){return e.type in r}),o=a.filter(R.nodes,function(t){return t.cluster==e});t?a.each(i,function(e){var t=a.groupBy(o,function(t){return K(t,e.raw_attribute_key)}),r=a.keys(t).sort(),i=n.append("li");i.append("code").text(e.raw_attribute_key);var s=i.append("dl").classed("dl-horizontal",!0);a.each(r,function(e){s.append("dt").text(e),s.append("dd").text(a.map(t[e],function(e){return e.id}).join(", "))})}):a.each(a.filter(R.nodes,function(t){return t.cluster==e}),function(e){var t=n.append("li");t.append("code").text(e.id);var r=t.append("dl").classed("dl-horizontal",!0);a.each(i,function(t){r.append("dt").text(t.raw_attribute_key),r.append("dd").text(K(e,t.raw_attribute_key))})})};t("#"+M+"_cluster_zoom").on("show.bs.modal",function(n){var i=t(n.relatedTarget).data("cluster");r.select("#"+M+"_cluster_zoom").selectAll(".modal-title").text("Cluster "+i),t("#"+M+"_cluster_zoom_svg_export").on("click",function(e){o.save_image("png","#"+M+"_cluster_zoom_svg")});var s={},c=0,u={Nodes:a.map(a.filter(R.nodes,function(e,t){return e.cluster==i&&(s[t]=c++,!0)}),function(e){var t=a.clone(e);return t.cluster=1,delete t.parent,t}),Edges:a.map(a.filter(R.edges,function(e){return e.source in s&&e.target in s}),function(e){var t=a.clone(e);return t.target=s[t.target],t.source=s[t.source],t})};u[l]=R.json[l],e(u,"#"+M+"_cluster_zoom_svg",null,null,null,null,0,null,null,"#"+M+"_cluster_zoom_body",{expand:[1],charge:10,"minimum size":0,colorizer:R.colorizer,node_shaper:R.node_shaper,width:600})}),r.select("#"+M+"_cluster_list_view_toggle").on("click",function(){r.event.preventDefault();var e=!1,n=t(this);"id"==n.data("view")?(n.data("view","attribute"),n.text("Group by ID"),e=!1):(n.data("view","id"),n.text("Group by attribute"),e=!0),c(n.data("cluster"),!e,r.select("#"+M+"_cluster_list_payload"))}),t("#"+M+"_cluster_list").on("show.bs.modal",function(e){var n=t(e.relatedTarget).data("cluster"),a=r.select("#"+M+"_cluster_list");a.selectAll(".modal-title").text("Listing nodes in cluster "+n),t("#"+M+"_cluster_list_view_toggle").data("cluster",n),c(n,"id"!=t("#"+M+"_cluster_list_view_toggle").data("view"),a.select("#"+M+"_cluster_list_payload"))});var d=r.select("#"+M+"_cluster_operations_container");d.selectAll("li").remove();var f=[["Expand All",function(){return R.expand_some_clusters()},!0,"hivtrace-expand-all"],["Collapse All",function(){return R.collapse_some_clusters()},!0,"hivtrace-collapse-all"],["Expand Filtered",function(){return R.expand_some_clusters(R.select_some_clusters(function(e){return e.match_filter}))},!0,"hivtrace-expand-filtered"],["Collapse Filtered",function(){return R.collapse_some_clusters(R.select_some_clusters(function(e){return e.match_filter}))},!0,"hivtrace-collapse-filtered"],["Hide problematic clusters",function(e){r.select(e).text(R.hide_hxb2?"Hide problematic clusters":"Show problematic clusters"),R.toggle_hxb2()},R.has_hxb2_links,"hivtrace-hide-problematic-clusters"]];R._is_CDC_||f.push(["Show removed edges",function(e){R.filter_edges=!R.filter_edges,r.select(e).text(R.filter_edges?"Show removed edges":"Hide removed edges"),R.update(!1)},function(){return a.some(R.edges,function(e){return e.removed})},"hivtrace-show-removed-edges"]),f.forEach(function(e,t){var n=e[1];e[2]&&this.append("li").append("a").text(e[0]).attr("href","#").attr("id",e[3]).on("click",function(e){n(this),r.event.preventDefault()})},d);var p=r.select("#"+M+"_button_group");p.empty()||(p.selectAll("button").remove(),p.append("button").classed("btn btn-default btn-sm",!0).attr("title","Expand spacing").on("click",function(e){O(5/4)}).append("i").classed("fa fa-plus",!0),p.append("button").classed("btn btn-default btn-sm",!0).attr("title","Compress spacing").on("click",function(e){O(.8)}).append("i").classed("fa fa-minus",!0),p.append("button").classed("btn btn-default btn-sm",!0).attr("title","Enlarge window").on("click",function(e){F(100,!0)}).append("i").classed("fa fa-expand",!0),p.append("button").classed("btn btn-default btn-sm",!0).attr("title","Shrink window").on("click",function(e){F(-100,!0)}).append("i").classed("fa fa-compress",!0),R._is_CDC_||p.append("button").classed("btn btn-default btn-sm",!0).attr("title","Compute graph statistics").attr("id","hivtrace-compute-graph-statistics").on("click",function(e){a.bind(R.compute_graph_stats,this)()}).append("i").classed("fa fa-calculator",!0),p.append("button").classed("btn btn-default btn-sm",!0).attr("title","Save Image").attr("id","hivtrace-export-image").on("click",function(e){o.save_image("png","#network-svg")}).append("i").classed("fa fa-image",!0)),t("#"+M+"_filter").on("input propertychange",a.throttle(function(e){var n=t(this).val();R.filter(n.split(" ").filter(function(e){return e.length>0}).map(function(e){if(e.length>2){if('"'==e[0]&&'"'==e[e.length-1])return{type:"re",value:new RegExp("^"+e.substr(1,e.length-2)+"$","i")};if("<"==e[0]){var t=parseFloat(e.substr(1));if(t>0)return{type:"distance",value:t}}}return{type:"re",value:new RegExp(e,"i")}}))},250)),t("#"+M+"_hide_filter").on("change",a.throttle(function(e){R.hide_unselected=!R.hide_unselected,R.filter_visibility(),R.update(!0)},250)),t("#"+M+"_show_small_clusters").on("change",a.throttle(function(e){R.current_size_filter==R.filter_by_size?R.current_size_filter=function(){return!0}:R.current_size_filter=R.filter_by_size,R.update(!1)},250)),t("#"+M+"_pairwise_table_pecentage").on("change",a.throttle(function(e){R.show_percent_in_pairwise_table=!R.show_percent_in_pairwise_table,ce("#"+M+"_attribute_table",R.colorizer.category_map,R.colorizer.category_pairwise)},250))}if(l in n?C=n[l]:C&&"hivtrace"in C&&(C=C.hivtrace),C){if("attribute_map"in C){var h=C.attribute_map;"map"in h&&h.map.length>0&&(me[l]=h.map.map(function(e,t){return{label:e,type:null,values:{},index:t,range:0}}),me.Nodes.forEach(function(e){e[l]=e.id.split(h.delimiter),e[l].forEach(function(e,t){t<me[l].length&&(e in me[l][t].values||(me[l][t].values[e]=me[l][t].range,me[l][t].range+=1))})}),me[l].forEach(function(e){e.range<me.Nodes.length&&e.range>1&&e.range<=20&&(e.type="category")}))}if(a.each(R._networkPredefinedAttributeTransforms,function(e,t){if(!e.depends||a.has(me[l],e.depends)){var n={};n[t]=e,a.extend(me[l],n),a.each(me.Nodes,function(n){ee(n,t,e.map(n))})}}),M){var m=a.filter(a.map(me[l],function(e,t){return e.raw_attribute_key=t,"String"==e.type?(e.value_range=a.keys(a.countBy(me.Nodes,function(e){return K(e,t)})),e.dimension=e.value_range.length):"enum"in e&&(e.value_range=a.clone(e.enum),e.value_range.push(u),e.dimension=e.value_range.length,e["no-sort"]=!0),e}),function(e){return"value_range"in e&&e.value_range.length<=b}),_=a.filter(m,function(e){return e.dimension<=7||e.raw_attribute_key in w});a.each([m,_],function(e){a.each(e,function(e){var t;if(e["no-sort"])t=e.value_range;else if("String"==e.type){if(t=e.value_range.sort(),e.dimension<=b){for(var n=a.map(t,function(e){for(var t=5801,n=0;n<e.length;n++)t=(t<<5+t)+e.charCodeAt(n);return t}),r={},i={},o=0;o<b;o++)r[o]=!0;a.each(n,function(e,n){e<0&&(e=-e);var o=e%b;if(o in r)return i[t[n]]=o,void delete r[o];var s=Math.floor(e/b)%b;if(s in r)return i[t[n]]=s,void delete r[s];var l=parseInt(a.keys(r).sort()[0]);i[t[n]]=l,delete r[l]}),e["stable-ish order"]=i}}else t=e.value_range.sort();var s=new Object;a.each(t,function(e,t){s[e]=t}),e.value_map=function(e,t){return t?"lookup"==t?a.invert(s):s:s[e]}})});var v=a.filter(a.map(me[l],function(e,t){function n(e,t,n){var i=1/0;a.each(n,function(n){e.value_range=r.extent(t);var o=a.map(a.range(9),function(){return 0});n.range([0,8]).domain(e.value_range),a.each(t,function(e){o[Math.floor(n(e))]++});var s=t.length/9,l=a.reduce(o,function(e,t){return e+(t-s)*(t-s)});l<i&&(i=l,e.scale=n)})}return e.raw_attribute_key=t,"Number"==e.type?n(e,a.filter(a.map(me.Nodes,function(e){return K(e,t,!0)}),function(e){return e==u?null:e}),[r.scale.linear(),r.scale.log(),r.scale.pow().exponent(1/3),r.scale.pow().exponent(.25),r.scale.pow().exponent(.5),r.scale.pow().exponent(1/8),r.scale.pow().exponent(1/16)]):"Date"==e.type&&n(e,a.filter(a.map(me.Nodes,function(e){try{var n=K(e,t);ee(e,t,g.parse(n))}catch(n){ee(e,t,u)}return K(e,t)}),function(e){return e==u?null:e}),[r.time.scale()]),e}),function(e){return"Number"==e.type||"Date"==e.type});[r.select("#"+M+"_attributes"),r.select("#"+M+"_attributes_cat")].forEach(function(e){e.selectAll("li").remove();var t=[[["None",null,a.partial($,null)]],[["Categorical","heading",null]]].concat(m.map(function(e,t){return[[e.label,e.raw_attribute_key,a.partial($,e.raw_attribute_key)]]}));v.length&&(t=t.concat([[["Continuous","heading",null]]]).concat(v.map(function(e,t){return[[e.label,e.raw_attribute_key,a.partial(J,e.raw_attribute_key)]]})));var n=e.selectAll("li").data(t);n.enter().append("li").classed("disabled",function(e){return"heading"==e[0][1]}).style("font-variant",function(e){return e[0][1]<-1?"small-caps":"normal"}),n.selectAll("a").data(function(e){return e}).enter().append("a").text(function(e,t,n){return e[0]}).attr("style",function(e,t,n){return"heading"==e[1]?"font-style: italic":0==n?" font-weight: bold;":null}).attr("href","#").on("click",function(e){e[2]&&e[2].call()})}),[r.select("#"+M+"_shapes")].forEach(function(e){e.selectAll("li").remove();var t=e.selectAll("li").data([[["None",null,a.partial(W,null)]]].concat(_.map(function(e,t){return[[e.label,e.raw_attribute_key,a.partial(W,e.raw_attribute_key)]]})));t.enter().append("li").style("font-variant",function(e){return e[0][1]<-1?"small-caps":"normal"}),t.selectAll("a").data(function(e){return e}).enter().append("a").text(function(e,t,n){return e[0]}).attr("style",function(e,t,n){return 0==n?" font-weight: bold;":null}).attr("href","#").on("click",function(e){e[2]&&e[2].call()})}),t("#"+M+"_opacity_invert").on("click",function(e){R.colorizer.opacity_scale&&(R.colorizer.opacity_scale.range(R.colorizer.opacity_scale.range().reverse()),R.update(!0),V()),t(this).toggleClass("btn-active btn-default")}),t("#"+M+"_attributes_invert").on("click",function(e){R.colorizer.category_id&&(me[l][R.colorizer.category_id].scale.range(me[l][R.colorizer.category_id].scale.range().reverse()),R.clusters.forEach(function(e){e.gradient=Z(e,R.colorizer.category_id)}),R.update(!0),V()),t(this).toggleClass("btn-active btn-default")}),[r.select("#"+M+"_opacity")].forEach(function(e){e.selectAll("li").remove();var t=e.selectAll("li").data([[["None",null,a.partial(X,null)]]].concat(v.map(function(e,t){return[[e.label,e.raw_attribute_key,a.partial(X,e.raw_attribute_key)]]})));t.enter().append("li").style("font-variant",function(e){return e[0][1]<-1?"small-caps":"normal"}),t.selectAll("a").data(function(e){return e}).enter().append("a").text(function(e,t,n){return e[0]}).attr("style",function(e,t,n){return 0==n?" font-weight: bold;":null}).attr("href","#").on("click",function(e){e[2]&&e[2].call()})})}}if(R.cluster_sizes.length>_e){for(var y=R.cluster_sizes.map(function(e,t){return[e,t+1]}).sort(function(e,t){return e[0]-t[0]}),x=0;x<y.length-_e;x++)R.exclude_cluster_ids[y[x][1]]=1;ve="Excluded "+(y.length-_e)+" clusters (maximum size "+y[x-1][0]+" nodes) because only "+_e+" objects can be shown at once."}me.Nodes.filter(function(e,t){return null===e.cluster}).length,R.nodes=me.Nodes.filter(function(e,t){return!(!e.cluster||void 0!==R.exclude_cluster_ids[e.cluster]||(i[t]=s++,0))}),R.edges=me.Edges.filter(function(e,t){return null!=i[e.source]&&null!=i[e.target]}),R.edges=R.edges.map(function(e,t){return e.source=i[e.source],e.target=i[e.target],e.id=t,e}),function(e,t){for(var n in e)e[n].degree=0;for(var r in t)e[t[r].source].degree++,e[t[r].target].degree++}(R.nodes,R.edges);var k=j(R.clusters,R.nodes);R.clusters=k[0],R.nodes=k[1],R.clusters.forEach(function(e,t){R.cluster_mapping[e.cluster_id]=t,e.hxb2_linked=e.children.some(function(e){return e.hxb2_linked});var n=e.children.map(function(e){return e.degree});n.sort(r.ascending),e.degrees=o.describe_vector(n),e.distances=[]}),R.edges.forEach(function(e,t){R.clusters[R.cluster_mapping[R.nodes[e.target].cluster]].distances.push(e.length)}),R.clusters.forEach(function(e,t){e.distances=o.describe_vector(e.distances)}),R.update()}(),r.select(R.container).selectAll(".my_progress").style("display","none"),I&&(a.isNumber(I.charge)&&(R.charge_correction=I.charge),"colorizer"in I&&(R.colorizer=I.colorizer),"node_shaper"in I&&(R.node_shaper=I.node_shaper),V(),xe.start(),a.isArray(I.expand)&&R.expand_some_clusters(a.filter(R.clusters,function(e){return I.expand.indexOf(e.cluster_id)>=0}))),R},e.exports.graphSummary=function(e,t){var n=r.select(t);(n=r.select(t).select("tbody")).empty()&&(n=r.select(t).append("tbody"));var i=[];n.empty()||a.each(e["Network Summary"],function(e,t){self._is_CDC_&&"Edges"==t&&(t="Links"),a.isNumber(e)&&i.push([t,e])});var s=[];a.each(e.Degrees.Distribution,function(e,t){for(var n=0;n<e;n++)s.push(t+1)}),s=o.describe_vector(s),i.push(["Links/node",""]),i.push(["&nbsp;&nbsp;<i>Mean</i>",p(s.mean)]),i.push(["&nbsp;&nbsp;<i>Median</i>",p(s.median)]),i.push(["&nbsp;&nbsp;<i>Range</i>",s.min+" - "+s.max]),i.push(["&nbsp;&nbsp;<i>Interquartile range</i>",s.Q1+" - "+s.Q3]),s=o.describe_vector(e["Cluster sizes"]),i.push(["Cluster sizes",""]),i.push(["&nbsp;&nbsp;<i>Mean</i>",p(s.mean)]),i.push(["&nbsp;&nbsp;<i>Median</i>",p(s.median)]),i.push(["&nbsp;&nbsp;<i>Range</i>",s.min+" - "+s.max]),i.push(["&nbsp;&nbsp;<i>Interquartile range</i>",s.Q1+" - "+s.Q3]),self._is_CDC_&&(s=o.describe_vector(a.map(e.Edges,function(e){return e.length})),i.push(["Genetic distances (links only)",""]),i.push(["&nbsp;&nbsp;<i>Mean</i>",h(s.mean)]),i.push(["&nbsp;&nbsp;<i>Median</i>",h(s.median)]),i.push(["&nbsp;&nbsp;<i>Range</i>",h(s.min)+" - "+h(s.max)]),i.push(["&nbsp;&nbsp;<i>Interquartile range</i>",h(s.Q1)+" - "+h(s.Q3)]));var l=n.selectAll("tr").data(i);l.enter().append("tr"),l.exit().remove();var c=l.selectAll("td").data(function(e){return e});c.enter().append("td"),c.exit(),c.html(function(e){return e})}}).call(t,n(2))},43:function(e,t,n){(function(t){"use strict";var r=n(39),a=n(42),o=n(44);function s(e){var t=e.Nodes,n=e.Edges,r={};return n.forEach(function(e,n){function a(e,t){return e.id==t}var i=e.sequences,o=t.filter(function(e){return a(e,i[0])})[0],s=t.filter(function(e){return a(e,i[1])})[0];r[o.id]?r[o.id].push(s):r[o.id]=[s],r[s.id]?r[s.id].push(o):r[s.id]=[o]}),r}var l={};a.each(a.range(3,20),function(e){var t=2*Math.PI/e;l[e]=a.map(a.range(1,e),function(e){return[Math.cos(t*e),Math.sin(t*e)]})});var c=function(){var e=this;return e.ellipse=function(){return"M "+e.radius+" 0 A "+1*e.radius+" "+.75*e.radius+" 0 1 0 "+e.radius+" 0.00001"},e.ellipse.type=function(){return e.ellipse},e.ellipse.size=function(t){return a.isNumber(t)?(e.size=t,e.radius=Math.sqrt(1.25*t/Math.PI),e.ellipse):e.size},e.ellipse.size(64),e.ellipse},u=function(){var e=this;return e.polygon=function(){var t=" M"+e.radius+" 0";if(e.sides in l)t+=l[e.sides].map(function(t){return" L"+e.radius*t[0]+" "+e.radius*t[1]}).join(" ");else{var n=2*Math.PI/e.sides,r=0;for(i=0;i<e.sides-1;i++)r+=n,t+=" L"+e.radius*Math.cos(r)+" "+e.radius*Math.sin(r)}return t+" Z"},e.polygon.sides=function(t){return a.isNumber(t)&&t>2?(e.sides=t,e.polygon):e.sides},e.polygon.type=function(){return e.polygon},e.polygon.size=function(t){return a.isNumber(t)?(e.size=t,e.radius=Math.sqrt(t/Math.PI),e.polygon):e.size},e.polygon.size(64),e.sides=6,e.polygon};function d(e){var t=e.Nodes,n=e.Edges;t.forEach(function(e){e.neighbors=r.set()}),n.forEach(function(e){t[e.source].neighbors.add(e.target),t[e.target].neighbors.add(e.source)})}function f(e,t,n){var r=[];t=parseInt(t),n=parseInt(n);for(var a=0;a<e[t][n].length;a++){var i=e[t][n][a],o=i;if(null===o||o==t)return[[parseInt(t),parseInt(n)]];for(var s=f(e,t,o),l=f(e,o,n),c=0;c<s.length;c++)for(var u=s[c],d=0;d<l.length;d++){var p=l[d];u.length&&u[0]==t&&u[u.length-1]==i&&p[0]==i&&p[p.length-1]==n&&(u.pop(),r.push(u.concat(p)))}}return r}function p(e,t,n,a){var i=f(t,n,a);if(!(i=i.map(function(e){return e.slice(1,-1)})))return 0;for(var o=[],s=0;n<i.length;s++)sublist=i[s],o.push(r.sum(sublist.map(function(t){return t==e})));var l=r.mean(o);return void 0===l&&(l=0),l}function h(e,t,n){var r=[],i=[],o=(e.Nodes,e.Edges,s(e));t||(t=Object.keys(o));for(var l=t.length,c=0;c<t.length;c++){var u=t[c],d=a.range(l).map(function(e){return null}),f=a.range(l).map(function(e){return null});r.push(f),i.push(d)}for(var p=0;p<t.length;p++){u=t[p];for(var h=0;h<t.length;h++){var g=t[h];g!=u&&-1!=o[u].map(function(e){return e.id}).indexOf(g)&&(r[p][h]=1,r[h][p]=1)}}for(var m=0;m<t.length;m++)for(var _=t[m],v=0;v<t.length;v++)t[v],i[m][v]=m==v?[]:[m];for(var b=a.map(r,a.clone),y=0;y<t.length;y++){for(t[y],m=0;m<t.length;m++)for(_=t[m],v=0;v<t.length;v++)if(_!=t[v]){if(d_ik=r[y][m],d_jk=r[y][v],d_ij=r[m][v],null!==d_ik&&null!==d_jk){if(d_ik+=d_jk,null===d_ij||d_ij>d_ik){b[m][v]=d_ik,b[v][m]=d_ik,i[m][v]=[],i[m][v]=i[m][v].concat(i[y][v]);continue}d_ij==d_ik&&(i[m][v]=i[m][v].concat(i[y][v]))}b[v][m]=r[v][m],b[m][v]=r[m][v]}var x=b;b=r,r=x}return{ordering:t,distances:r,next:i}}function g(e,t,n){if(!n){var i=function(e,t){var n,r=t.Nodes,a=t.Edges,i=r.filter(function(t){return e==t.id});if(!i)return console.log("could not find node"),null;n=i[0].cluster;var o=r.filter(function(e){return n==e.cluster}),s=o.map(function(e){return e.id}),l=a.filter(function(e){return-1!=s.indexOf(e.sequences[0])}),c={};return c.Nodes=o,c.Edges=l,c}(e,t);n=h(i)}var o=n.ordering.indexOf(e);if(-1==o)return null;var s=n.distances.length;scale=2!=s?1/((s-1)*(s-2)):1;var l=[];for(var c in a.range(s))for(var u in a.range(s))l.push(p(o,n.next,c,u));return r.sum(l)*scale}function m(e){var t=e.Nodes,n=e.Edges;for(var r in t)t[r].degree=0;for(var a in n)t[n[a].source].degree++,t[n[a].target].degree++}function _(e,t){return t.Nodes.filter(function(t){return e==t.id})[0]||void 0}function v(e){return-1!=e.attributes.indexOf("problematic")}function b(e,t){m(e),function(e,t){var n=e.Nodes.map(function(e){return e.cluster}).filter(function(e,t,n){return n.indexOf(e)===t}),r=0;function a(a,i){for(var o in r++,i)_(o,e).betweenness=i[o];r>=n.length&&t()}n.forEach(function(t){hivtrace_betweenness_centrality_all_nodes_in_cluster(t,e,a)})}(e,function(n){var a=e.Nodes.map(function(e){return[e.id,e.cluster,e.degree,e.betweenness,v(e),e.attributes.join(";")]});a.unshift(["seqid","cluster","degree","betweenness","is_contaminant","attributes"]),node_csv=r.csv.format(a),t(null,node_csv)})}var y=a.once(function(e){d(e);var t=e.Nodes;t.forEach(function(e){var n=e,r=n.neighbors.size();if(r<2)n.lcc=void 0;else if(r>500)n.lcc=hivtrace_too_large;else{for(neighborhood=n.neighbors.values(),counter=0,n1=0;n1<r;n1+=1)for(n2=n1+1;n2<r;n2+=1)t[neighborhood[n1]].neighbors.has(neighborhood[n2])&&counter++;n.lcc=2*counter/r/(r-1)}})});e.exports.compute_node_degrees=m,e.exports.export_csv_button=function(e,n){b(e,function(e,r){if(null!==r){var a=document.createElement("a");a.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(r)),a.setAttribute("download","export.csv"),a.className="btn btn-default btn-sm",a.innerHTML='<span class="glyphicon glyphicon-floppy-save"></span> Export Results',t(n).append(a)}})},e.exports.convert_to_csv=b,e.exports.betweenness_centrality=g,e.exports.betweenness_centrality_all_nodes_in_cluster=function(e,t,n){var r=t.Nodes,a=t.Edges,i=r.filter(function(t){return e==t.cluster}),o=i.map(function(e){return e.id}),s=a.filter(function(e){return-1!=o.indexOf(e.sequences[0])}),l={};if(l.Nodes=i,l.Edges=s,i.length>70)n("cluster too large",null);else{var c=h(l),u=(o=i.map(function(e){return e.id}),{});i.forEach(function(e){u[e.id]=g(e.id,l,c)}),n(null,u)}},e.exports.cluster_adjacency_list=s,e.exports.new_cluster_adjacency_list=d,e.exports.analysis_settings=function(e,t){},e.exports.export_table_to_text=function(e,t,n){var a=r.select(e);return a.selectAll("[data-type='download-button']").remove(),(a=a.append("a").attr("target","_blank").attr("data-type","download-button").on("click",function(e,t){r.event.preventDefault();var n=r.select(this).attr("data-table"),a=o.table_to_text(n);o.export_handler(a,n.substring(1)+".tsv","text/tab-separated-values")}).attr("data-table",t)).append("i").classed("fa fa-download fa-2x",!0),a},e.exports.compute_local_clustering=y,e.exports.undefined={},e.exports.too_large={},e.exports.processing={},e.exports.format_value=function(e,t){return void 0===e?"Not computed":e===hivtrace_undefined?"Undefined":e===hivtrace_too_large?"Size limit":e===hivtrace_processing?'<span class="fa fa-spin fa-spinner"></span>':t?t(e):e},e.exports.polygon=u,e.exports.symbol=function(e){switch(e){case"circle":case"cross":case"diamond":case"square":case"triangle-down":case"triangle-up":return r.svg.symbol().type(e);case"triangle":return(new u).sides(3);case"pentagon":return(new u).sides(5);case"hexagon":return(new u).sides(6);case"septagon":return(new u).sides(7);case"octagon":return(new u).sides(8);case"ellipse":return new c}return r.svg.symbol().type("circle")}}).call(t,n(2))},44:function(e,t,n){(function(t,r,a,i){"use strict";var o=n(45);function s(e){var n=document.getElementById("image");n.src=e,n.onload=function(){var e=document.getElementById("canvas");e.width=n.width,e.height=n.height;var r=e.getContext("2d");r.fillStyle="#FFFFFF",r.fillRect(0,0,n.width,n.height),r.drawImage(n,0,0),e.toDataURL("image/png");var a=document.createElement("a");a.setAttribute("download","phylotree.png"),a.href=e.toDataURL("image/png"),t("body").append(a),a.click(),a.remove()}}function l(e,t){return t=t||function(e){return e},i.reduce(e,function(e,n,r){return e+t(n,r)},0)}e.exports.errorModal=function(e){t("#modal-error-msg").text(e),t("#errorModal").modal()},e.exports.export_csv_button=function(e){if(null!==(e=r.csv.format(e))){var n=document.createElement("a");n.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download","export.csv"),n.className="btn btn-default btn-sm",n.innerHTML='<span class="glyphicon glyphicon-floppy-save"></span> Download CSV',t("body").append(n),n.click(),n.remove()}},e.exports.save_image=function(e,n){var r="http://www.w3.org/2000/xmlns/",a=t(n).find("svg")[0];a||(a=t(n)[0]);var i=function(e){function t(e){try{if(e.cssRules)for(var r=0;r<e.cssRules.length;r++){var a=e.cssRules[r];3===a.type?t(a.styleSheet):a.selectorText&&-1===a.selectorText.indexOf(">")&&(n+="\n"+a.cssText)}}catch(t){console.log("Could not process stylesheet : "+e)}}var n="",r=e.styleSheets;if(r)for(var a=0;a<r.length;a++)t(r[a]);return n}(window.document);a.setAttribute("version","1.1");var s=document.createElement("defs");a.insertBefore(s,a.firstChild);var l=document.createElement("style");s.appendChild(l),l.setAttribute("type","text/css"),a.removeAttribute("xmlns"),a.removeAttribute("xlink"),a.hasAttributeNS(r,"xmlns")||a.setAttributeNS(r,"xmlns","http://www.w3.org/2000/svg"),a.hasAttributeNS(r,"xmlns:xlink")||a.setAttributeNS(r,"xmlns:xlink","http://www.w3.org/1999/xlink");var c,u,d,f,p=(new XMLSerializer).serializeToString(a).replace("</style>","<![CDATA["+i+"]]></style>"),h=(a.getBoundingClientRect(),"data:image/svg+xml;base66,"+encodeURIComponent(['<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+p]));if(navigator.msSaveBlob)o(h,"image.svg","image/svg+xml");else if("png"==e)c=h,u=function(e){var n=window.URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("download","image.png"),r.setAttribute("href",n),t("body").append(r),r.click(),r.remove()},d=function(e){console.log(e)},(f=new Image).onerror=d,f.onload=function(){var e=document.getElementById("hyphy-chart-canvas");e.width=f.width,e.height=f.height;var t=e.getContext("2d");if(t.fillStyle="#FFFFFF",t.fillRect(0,0,e.width,e.height),t.drawImage(f,0,0,e.width,e.height),e.msToBlob){var n=e.msToBlob(u);u(n),window.navigator.msSaveBlob(n,"image.png")}else e.toBlob(u)},f.src=c;else{var g=document.createElement("a");g.setAttribute("download","image.svg"),g.setAttribute("href",h),t("body").append(g),g.click(),g.remove()}},e.exports.validate_date=function(){0===t(this).val().length?(t(this).next(".help-block").remove(),t(this).parent().removeClass("has-success"),t(this).parent().addClass("has-error"),a("<span/>",{class:"help-block",text:"Field is empty"}).insertAfter(t(this))):isNaN(Date.parse(t(this).val()))?(t(this).next(".help-block").remove(),t(this).parent().removeClass("has-success"),t(this).parent().addClass("has-error"),a("<span/>",{class:"help-block",text:"Date format should be in the format YYYY-mm-dd"}).insertAfter(t(this))):(t(this).parent().removeClass("has-error"),t(this).parent().addClass("has-success"),t(this).next(".help-block").remove())},e.exports.save_newick_to_file=function(){var e=t("#neighbor-tree-modal").data("tree"),n=document.createElement("a");n.setAttribute("href","data:text/octet-stream;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download","nwk.txt"),t("body").append(n),n.click(),n.remove()},e.exports.convert_svg_to_png=s,e.exports.save_newick_tree=function(e){var n="http://www.w3.org/2000/xmlns/",r=t("#tree_container").find("svg")[0],a=function(e){var t="",n=e.styleSheets;if(n)for(var r=0;r<n.length;r++)a(n[r]);function a(e){if(e.cssRules)for(var n=0;n<e.cssRules.length;n++){var r=e.cssRules[n];3===r.type?a(r.styleSheet):r.selectorText&&-1===r.selectorText.indexOf(">")&&(t+="\n"+r.cssText)}}return t}(window.document);r.setAttribute("version","1.1");var i=document.createElement("defs");r.insertBefore(i,r.firstChild);var o=document.createElement("style");i.appendChild(o),o.setAttribute("type","text/css"),r.removeAttribute("xmlns"),r.removeAttribute("xlink"),r.hasAttributeNS(n,"xmlns")||r.setAttributeNS(n,"xmlns","http://www.w3.org/2000/svg"),r.hasAttributeNS(n,"xmlns:xlink")||r.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink");var l=(new XMLSerializer).serializeToString(r).replace("</style>","<![CDATA["+a+"]]></style>"),c=(r.getBoundingClientRect(),"data:image/svg+xml;base66,"+encodeURIComponent(['<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+l]));if("png"==e)s(c);else{var u=document.createElement("a");u.setAttribute("download","phylotree.svg"),u.setAttribute("href",c),t("body").append(u),u.click(),u.remove()}},e.exports.validate_email=function(e){t(this).find("input[name='receive_mail']")[0].checked?/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t(this).find("input[name='mail']").val())?(t(this).removeClass("has-error"),t(this).addClass("has-success"),t(this).next(".help-block").remove()):(t(this).next(".help-block").remove(),t(this).removeClass("has-error"),t(this).removeClass("has-success"),t(this).addClass("has-error"),a("<span/>",{class:"help-block col-lg-9 pull-right",text:"Invalid Email"}).insertAfter(t(this))):(t(this).removeClass("has-error"),t(this).removeClass("has-success"),t(this).next(".help-block").remove())},e.exports.describe_vector=function(e,t){var n={};return e.length?(e.sort(r.ascending),n={min:r.min(e),max:r.max(e),median:r.median(e),Q1:r.quantile(e,.25),Q3:r.quantile(e,.75),mean:r.mean(e)}):n={min:null,max:null,median:null,Q1:null,Q3:null,mean:null},t&&(n="<pre>Range  :"+n.min+"-"+n.max+"\nIQR    :"+n.Q1+"-"+n.Q3+"\nMean   :"+n.mean+"\nMedian :"+n.median+"\n</pre>"),n},e.exports.table_to_text=function(e,t){t=t||"\t";var n=[];r.select(e+" thead").selectAll("th").each(function(){n.push(r.select(this).text())});var a=[];return r.select(e+" tbody").selectAll("tr").each(function(e,t){a.push([]),r.select(this).selectAll("td").each(function(){a[t].push(r.select(this).text())})}),n.join(t)+"\n"+a.map(function(e){return e.join(t)}).join("\n")},e.exports.export_handler=function(e,t,n){if(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./)){var r=window.open();r.document.write(e),r.document.close(),r.document.execCommand("SaveAs",!0,t+".csv"),r.close()}else{var a=document.createElement("a");a.setAttribute("href","data:"+(n||"text/plain")+";charset=utf-8,"+encodeURIComponent(e)),a.setAttribute("download",t||"download.tsv"),a.click(),a.remove()}},e.exports.capitalize=function(e){return e.length>0?e[0].toUpperCase()+e.slice(1):e},e.exports.countPartitionsJSON=function(e){try{return i.keys(e).length}catch(e){}return 0},e.exports.countSitesFromPartitionsJSON=function(e){try{return l(e.partitions,function(e){return e.coverage[0].length})}catch(e){}return 0},e.exports.sum=l,e.exports.filter=function(e,t,n){var r={};return t=i.bind(t,n),i.each(e,i.bind(function(e,n){t(e,n)&&(r[n]=e)},n)),r},e.exports.map=function(e,t,n){var r={};return t=i.bind(t,n),i.each(e,i.bind(function(e,n){r[n]=t(e,n)},n)),r}}).call(t,n(2),n(39),n(2),n(42))},45:function(e,t,n){var r,a;void 0===(a="function"==typeof(r=function(){return function e(t,n,r){var a,i,o=window,s="application/octet-stream",l=r||s,c=t,u=!n&&!r&&c,d=document.createElement("a"),f=function(e){return String(e)},p=o.Blob||o.MozBlob||o.WebKitBlob||f,h=n||"download";if(p=p.call?p.bind(o):Blob,"true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),u&&u.length<2048&&(h=u.split("/").pop().split("?")[0],d.href=u,-1!==d.href.indexOf(u))){var g=new XMLHttpRequest;return g.open("GET",u,!0),g.responseType="blob",g.onload=function(t){e(t.target.response,h,s)},setTimeout(function(){g.send()},0),g}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&p!==f))return navigator.msSaveBlob?navigator.msSaveBlob(b(c),h):y(c);l=(c=b(c)).type||s}else if(/([\x80-\xff])/.test(c)){for(var m=0,_=new Uint8Array(c.length),v=_.length;m<v;++m)_[m]=c.charCodeAt(m);c=new p([_],{type:l})}function b(e){for(var t=e.split(/[:;,]/),n=t[1],r=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),a=r.length,i=0,o=new Uint8Array(a);i<a;++i)o[i]=r.charCodeAt(i);return new p([o],{type:n})}function y(e,t){if("download"in d)return d.href=e,d.setAttribute("download",h),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout(function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout(function(){o.URL.revokeObjectURL(d.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var n=document.createElement("iframe");document.body.appendChild(n),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),n.src=e,setTimeout(function(){document.body.removeChild(n)},333)}if(a=c instanceof p?c:new p([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(a,h);if(o.URL)y(o.URL.createObjectURL(a),!0);else{if("string"==typeof a||a.constructor===f)try{return y("data:"+l+";base64,"+o.btoa(a))}catch(e){return y("data:"+l+","+encodeURIComponent(a))}(i=new FileReader).onload=function(e){y(this.result)},i.readAsDataURL(a)}return!0}})?r.apply(t,[]):r)||(e.exports=a)},46:function(e,t,n){"use strict";var r=n(39);n(42),e.exports.scatterPlot=function(e,t,n,a,i,o){r.time.format("%B %d, %Y");var s=r.format(",.2r"),l=r.time.format("%B %Y"),c=t-100-10,u=n-10-100,d=(o?r.time.scale():r.scale.linear()).domain(r.extent(e,function(e){return e.x})).range([0,c]),f=(o?r.time.scale():r.scale.linear()).domain(r.extent(e,function(e){return e.y})).range([u,0]),p=r.svg.axis().scale(d).orient("bottom").tickFormat(o?l:s),h=r.svg.axis().scale(f).orient("left").tickFormat(o?l:s),g=r.select(a).selectAll("svg");g.empty()||g.remove(),(e=(g=r.select(a).append("svg").attr("width",t).attr("height",n).append("g").attr("transform","translate(100,10)")).selectAll("circle").data(e)).enter().append("circle"),e.attr("cx",function(e){return d(e.x)}).attr("cy",function(e){return f(e.y)}).attr("r",3).classed("node scatter",!0),e.each(function(e){"title"in e&&r.select(this).append("title").text(e.title)});var m=g.append("g").attr("class","x axis").attr("transform","translate(0,"+u+")").call(p);m.selectAll("text").attr("transform","rotate(-45)").attr("dx","-.5em").attr("dy",".25em").style("text-anchor","end"),m.append("text").text(i.x).attr("transform","translate("+c+",0)").attr("dy","-1em").attr("text-anchor","end");var _=g.append("g").attr("class","y axis").attr("transform","translate(0,0)").call(h);_.selectAll("text").attr("transform","rotate(-45)").attr("dx","-.5em").attr("dy",".25em").style("text-anchor","end"),_.append("text").text(i.y).attr("transform","rotate(-90)").attr("dy","1em").attr("text-anchor","end")}},47:function(e,t,n){"use strict";var r=n(39),a=n(42);t.histogram=function(e,t,n){var a=r.format(",.2f");!function(e,t,n,a,i){var o=10,s=30,l=50,c=30,u=300-c-s,d=300-o-l,f=r.scale.linear().domain([0,e.length+1]).range([0,u]),p=r.scale.log().domain([1,r.max(e)]).range([d,0]),h=r.sum(e),g=r.svg.axis().scale(f).orient("bottom"),m=r.select(i).selectAll("svg");m&&m.remove();var _=e.map(function(e,t){return{x:t+1,y:e+1}});_.push({x:e.length+1,y:1}),_.push({x:0,y:1}),_.push({x:0,y:e[0]+1}),m=r.select(i).insert("svg",".histogram-label").attr("width",u+c+s).attr("height",d+o+l).append("g").attr("transform","translate("+c+","+o+")").datum(_);var v=r.svg.line().x(function(e){return f(e.x)}).y(function(e){return p(e.y)}).interpolate("step-before");if(m.selectAll("path").remove(),m.append("path").attr("d",function(e){return v(e)+"Z"}).attr("class","histogram"),t){var b=r.svg.line().interpolate("linear").x(function(e,t){return f(t+1)+(f(t+1)-f(t))/2}).y(function(e){return p(1+e*h)});m.append("path").datum(t).attr("class","line").attr("d",function(e){return b(e)})}m.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(g).selectAll("text").attr("transform","rotate(45)").attr("dx","1em").attr("dy","0.5em")}(e.Degrees.Distribution,e.Degrees.fitted,0,0,t);var i="Network degree distribution is best described by the <strong>"+e.Degrees.Model+"</strong> model, with &rho; of "+a(e.Degrees.rho);null!=e.Degrees["rho CI"]&&(i+=" (95% CI "+a(e.Degrees["rho CI"][0])+" - "+a(e.Degrees["rho CI"][1])+")"),r.select(n).html(i)},t.histogramDistances=function(e,t,n){r.format(",.3p"),function(e,t,n,i){var o={top:10,right:30,bottom:50,left:10},s=300-o.right,l=300-o.top-o.bottom,c=r.select(i).selectAll("svg");if(c&&c.remove(),e.length>0){var u=r.layout.histogram()(e),d=r.scale.linear().domain(r.extent(e)),f=r.scale.linear().domain([0,r.max(a.map(u,function(e){return e.y}))]).range([l,0]);o.left+=10*Math.ceil(Math.log10(f.domain()[1])),s-=o.left,d.range([0,s]),console.log();var p=r.svg.axis().scale(d).orient("bottom"),h=r.svg.axis().scale(f).orient("left");u.splice(0,0,{x:d.domain()[0],y:0,dx:0}),u.splice(u.length,0,{x:d.domain()[1],y:0,dx:0}),c=r.select(i).insert("svg",".histogram-label").attr("width",s+o.left+o.right).attr("height",l+o.top+o.bottom).append("g").attr("transform","translate("+o.left+","+o.top+")").datum(u);var g=r.svg.line().x(function(e){return d(e.x+e.dx)}).y(function(e){return f(e.y)}).interpolate("step-before");c.selectAll("path").remove(),c.append("path").attr("d",function(e){return g(e)+"Z"}).attr("class","histogram"),c.append("g").attr("class","x axis").attr("transform","translate(0,"+l+")").call(p).selectAll("text").attr("transform","rotate(45)").attr("dx","1em").attr("dy","0.5em"),c.append("g").attr("class","y axis").call(h)}}(a.map(e.Edges,function(e){return e.length}),0,0,t),r.select(n).html("Genetic distances among linked nodes.")}}});